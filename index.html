<!doctype html>

<html lang="en">
	<head>
		<meta charset="utf-8">

		<title>Data set validation</title>
		<meta name="description" content="Validation of datasets">
		<meta name="author" content="IDLab">
		<script src="ldfetch.js"></script>

		<style type="text/css">
			li{
				color: orange;
			}

			.checked{
				color: green;
			}

			.failed{
				color: red;
			}
		</style>

		<!--[if lt IE 9]>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div>
			<ul>
				<li id="accessable">
					Accessable
				</li>
				<li id="license">
					License
				</li>
				<li id="cacheheaders">
					Cache headers
				</li>
				<li id="etagheaders">
					ETag
				</li>
				<li id="corsheaders">
					CORS headers
				</li>
				<li id="rdf">
					RDF
				</li>
				<li id="fragmentation">
					Fragmentation
				</li>
			</ul>
		</div>

		<form onsubmit="event.preventDefault(); check_url()">
			<input type="text" name="url" id="urlinput" value="https://linked.open.gent/parking?page=2018-02-14T13:00:00">
			<button onclick="">Validate</button>
		</form>

		<script>
			//Dataset url
			//var url = "https://linked.open.gent/parking?page=2018-02-14T13:00:00";

			var check_url = function(){
				url = document.getElementById("urlinput").value;

				//Analyse headers
				//********************************************************************
				var check_header = function(line_name, element_id, text, response){
					var che = document.getElementById(element_id);
					if(response.headers.get(line_name)){
						che.classList.add("checked");
						che.innerHTML = text + ": " + response.headers.get(line_name);
					}else{
						che.classList.add("failed");
					}
				}

				var accessable = null;
				var check_accessable = function(){
					if(accessable)
						document.getElementById("accessable").classList.add("checked");
					else if(accessable == null)
						accessable = true;
					else
						document.getElementById("accessable").classList.add("failed");
				}

				/*var options = { 
						headers: new Headers({
		    					"Access-Control-Allow-Origin": "\*",
		    					"Access-Control-Request-Headers":"\*"
		  				}
	  				)};*/

	  			var options = {}

				
				fetch(url, options).then(response => {
						for (var pair of response.headers.entries()) {
					        console.log(pair[0]+ ': '+ pair[1]);
					    }

						check_header("Cache-Control", "cacheheaders", "Cache header", response);
						check_header("ETag", "etagheaders", "ETag", response);
						check_header("Access-Control-Allow-Origin", "corsheaders", "CORS headers", response);

						check_accessable();
					}).catch(error => {
						document.getElementById("cacheheaders").classList.add("failed");
						document.getElementById("etagheaders").classList.add("failed");
						document.getElementById("corsheaders").classList.add("failed");
					});


				//Parse the dataset
				//*********************************************************************
				var ldfetch = new window.ldfetch();

				ldfetch.get(url).then(response => {
					document.getElementById("rdf").classList.add("checked");
					console.log("parsed");
					console.log(response);

					for (var triple in response.triples)
						if(triple.predicate == "http://dublincore.org/2012/06/14/dcterms#license")
							document.getElementById("license").classList.add("checked");
					if(!document.getElementById("license").classList.contains("checked"))
						document.getElementById("license").classList.add("failed");

					check_accessable();
				}).catch(error => {
					document.getElementById("rdf").classList.add("failed");
				});
			}
		</script>
	</body>
</html>